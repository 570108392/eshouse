<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>添加管理员-WeAdmin Frame型后台管理系统-WeAdmin 1.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/static/css/font.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/layer/2.3/skin/layer.css">
    <link rel="stylesheet" href="/static/css/weadmin.css">
</head>

<style>
    .layui-input, .layui-textarea {
        display: block;
        width: 190px !important;
        padding-left: 10px;
    }
</style>
<body>
<div class="weadmin-body">
    <form class="layui-form" id="user-add-form">
        <div>
            <div class="layui-inline">
                <div class="layui-form-item">
                    <label for="productWeight" class="layui-form-label">
                        <span class="we-red">*</span>权重
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="productWeight" name="productWeight" required="" lay-verify="required"
                               autocomplete="off"   class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="productTypeId" class="layui-form-label">
                        <span class="we-red">*</span>商品编码
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="productTypeId" name="productTypeId" required="" lay-verify="required"
                               autocomplete="off"   class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="productName" class="layui-form-label">
                        <span class="we-red">*</span>商品名称
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="productName" name="productName" required="" lay-verify="required"
                               autocomplete="off"   class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-inline">

                <div class="layui-form-item">
                    <label for="productStock" class="layui-form-label">
                        <span class="we-red">*</span>商品库存
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="productStock" name="productStock" required="" lay-verify="required"
                               autocomplete="off"   class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="productPrice" class="layui-form-label">
                        <span class="we-red">*</span>商品价钱
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="productPrice" name="productPrice" required="" lay-verify="required"
                               autocomplete="off"   class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="productStatus" class="layui-form-label">
                        <span class="we-red">*</span>商品状态
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="productStatus" name="productStatus" required="" lay-verify="required"
                           autocomplete="off"   class="layui-input">
                    </div>
                </div>

            </div>
            <div class="layui-inline">
                <div class="layui-form-item">
                    <label for="productUser" class="layui-form-label">
                        <span class="we-red">*</span>商品商家
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="productUser" name="productUser" required="" lay-verify="required"
                               autocomplete="off"   class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="productionDate" class="layui-form-label">
                        <span class="we-red">*</span>生产日期
                    </label>
                    <div class="layui-input-inline">
                        <input class="layui-input" id="productionDate" name="productionDate" required="" lay-verify="required"
                               autocomplete="off" >
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="productShelfLife" class="layui-form-label">
                        <span class="we-red">*</span>商品有效时间
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="productShelfLife" name="productShelfLife" required="" lay-verify="required"
                               autocomplete="off"   class="layui-input">
                    </div>
                    </div>
                </div>
        </div>
        <div style="height: 50px;margin-bottom: 20px;">
            <label for="productDesc" class="layui-form-label">
                <span class="we-red">*</span>商品描述
            </label>
            <textarea id="productDesc" name="productDesc" style="height: 100%;width: 500px;"></textarea>
        </div>
        <div style="height:80px;">
            <label for="productText" class="layui-form-label">
                <span class="we-red">*</span>商品简介
            </label>
            <textarea id="productText" name="productText" style="height: 100%;width: 500px;"></textarea>
        </div>

        <div style="float:right;width: 100%">
            <!--上传图片-->
            <div class="layui-upload">
                <button type="button" class="layui-btn" id="productImage">上传图片</button>
                <div class="layui-upload-list">
                    <img class="layui-upload-img" id="productImage_content"
                         src="https://t10.baidu.com/it/u=3457927833,1467857443&fm=76"
                         style="width: 100%;height: 500px;">
                    <p id="demoText"></p>
                </div>
            </div>
        </div>
    </form>
    <button class="layui-btn layui-btn-warm" onclick="user_search()" id="button-add" >增加
    </button>
</div>
<script src="/lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript">
    layui.use(['form', 'layedit', 'laydate', 'element', 'table', 'jquery', 'upload'], function () {
        var form = layui.form
            , upload = layui.upload
            , laydate = layui.laydate
            , $ = layui.jquery;
        //执行一个laydate实例 即开始时间
        laydate.render({
            elem: '#productionDate' //指定元素
        });
        form.render();
        window.user_search = function () {
            $.ajax({
                url: "/product/productAdd",
                type: 'post',//method请求方式，get或者post
                dataType: 'json',//预期服务器返回的数据类型
                contentType: "application/json;charset=UTF-8",
                data: JSON.stringify({
                    "productWeight": $("#productWeight").val(),
                    "productTypeId": $("#productTypeId").val(),
                    "productName": $("#productName").val(),
                    "productStock": $("#productStock").val(),
                    "productPrice": $("#productPrice").val(),
                    "productStatus": $("#productStatus").val(),
                    "productUser": $("#productUser").val(),
                    "productionDate": $("#productionDate").val(),
                    "productShelfLife": $("#productShelfLife").val(),
                    "productDesc": $("#productDesc").val(),
                    "productText": $("#productText").val(),
                    "productImage": $("#productImage_content").attr('src')
                }),
                success: function (data) {//res为相应体,function为回调函数
                    if (data.status == 200) {
                        layer.alert(data.t, {icon: 1});
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);//关闭当前页
                        window.parent.location.reload();

                    } else {
                        layer.alert(data.msg, {icon: 5});
                    }
                },
                error: function () {
                    layer.alert("添加用户失败", {icon: 5});
                }
            });
        };
        //普通图片上传
        var uploadInst = upload.render({
            elem: '#productImage'
            , url: '/file/imageUpload'
            , before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('#productImage_content').attr('src', result); //图片链接（base64）
                });
            }
            , done: function (res) {
                console.log(res);
                if (res.success) {
                    $('#productImage_content').attr('src', res.data);
                    return layer.msg('上传成功');
                } else {
                    return layer.msg('上传失败');
                }
            }
            , error: function () {
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function () {
                    uploadInst.upload();
                });
            }
        });

    });
</script>
</body>

</html>